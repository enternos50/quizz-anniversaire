<!DOCTYPE html>
<html lang="fr">
<head>
  <link rel="stylesheet" href="jeu.css">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Quiz Anniversaire</title>
  
   
</head>
<body>

  
  
  <button class="btn-accueil" onclick="allerAccueil()">üè† Accueil</button>
</div>



  <div id="quiz">
    <div id="joueurActuel"></div>
    <div class="question" id="question-text"></div>
    <div id="reponses"></div>
    <div id="progress-container" style="width: 100%; background-color: #ede4e4; height: 20px; border-radius: 10px; overflow: hidden; margin-bottom: 10px;">
  <div id="progress-bar" style="height: 100%; width: 100%; background-color: darkorange; transition: width 1s linear;"></div>
</div>
    <div id="timer" style="font-weight: bold; font-size: 1.2em; color: darkorange;"></div>
    <div id="resultat"></div>
  </div>

  <aside id="scoreSidebar">
    <h2>Scores</h2>
    <div id="joueursInfos"></div>
  </aside>

 



  <script>

    

    function melanger(array) {
  return array.sort(() => 0.5 - Math.random());
}


    const niveauQuiz = localStorage.getItem("niveauQuiz") || "Mixte";

    // Questions du quiz
    const toutesLesQuestions = [


{
  question: "Quel est le pr√©nom du cr√©ateur de ce quiz ?",
  reponses: ["gabriel", "gab", "je ne sais pas", "gaby"],
  bonne: ["gabriel", "gab", "gaby"], // <- plusieurs r√©ponses accept√©es
  niveau: "Facile",
  theme: "gabriel",
},
{
    question: "j'ai quel √¢ge ?",
    reponses: ["15", "16", "17", "18"],
    bonne: "18",
    niveau: "Facile",
    theme: "gabriel",
},

{
    question: "Quel est mon plat pr√©f√©r√© ?",
    reponses: ["p√¢tes", "pizza", "sushi", "burger"],
    bonne: "burger",
    niveau: "Facile",
    theme: "gabriel",
},
{
    question: "Quel est mon sport pr√©f√©r√© ?",
    reponses: ["foot", "basket", "tennis", "natation"],
    bonne: "basket",
    niveau: "Facile",
    theme: "gabriel",
},
{
    question: "Quel sport ai-je pratiqu√© avant le basket ?",
    reponses: ["foot", "tennis", "natation", "aqua-poney"],
    bonne: "foot",
    niveau: "Facile",
    theme: "gabriel",
},
{
  question: "quel est le pr√©nom de mon fr√©re ?",
  reponses: ["romain", "jsp", "robin", "robinou"],
  bonne: ["robin", "robinou"],
  niveau: "Facile",
  theme: "gabriel",
},
{
    question: "Quel est ma boisson pr√©f√©r√©e ?",
    reponses: ["coca", "orangina", "fanta", "ice tea"],
    bonne: "coca",
    niveau: "Moyen",
    theme: "gabriel",
},
{
    question: "J'ai d√©ja pris une photo avec un ancien joueur NBA ?",
    reponses: ["oui", "non", ],
    bonne: "oui",
    niveau: "Moyen",
},





{
    question: "Dans quelle ville suis-je n√© ?",
    reponses: ["Paris", "Cherbourg", "Marseille", "Tourlaville"],
    bonne: "Cherbourg",
    niveau: "Moyen",
},
{
    question: "Combien j'ai fait de voyage n√©c√©ssitant de prendre l'avion ?",
    reponses: ["3", "2", "5", "4"],
    bonne: "5",
    niveau: "Moyen",
},
{
    question: "Quel √©tait ma mati√®re pr√©f√©r√© au lyc√©e ?",
    reponses: ["math", "fran√ßais", "sport", "anglais"],
    bonne: "sport",
    niveau: "Moyen",
    theme: "gabriel",
},
{
  question: "Quel est mon dessert pr√©f√©r√© ?",
  reponses: ["charlotte a la fraise", "charlotte aux poire", "fondant au chocolat", "flan(pr√©f√©rer d'antonin)"],
  bonne: "charlotte aux poire",
  niveau: "Moyen",
  theme: "gabriel",
},
{
  question: "Quel est mon animal pr√©f√©r√© ?",
  reponses: ["chien", "chat", "lapin", "hamster"],
  bonne: "chien",
  niveau: "Moyen",
  theme: "gabriel",
},
{
  question: "Quel est ma couleur pr√©fer√© ?",
  reponses: ["bleu", "rouge", "vert", "jaune"],
  bonne: "jaune",
  niveau: "Moyen",
  theme: "gabriel",

},
{
  question: "Quelle appli j‚Äôutilise le plus ?",
  reponses: ["Instagram", "TikTok", "Snapchat", "YouTube"],
  bonne: "Instagram",
  niveau: "Moyen",
  theme: "gabriel",
},



{
  question: "quel est mon anim√© pr√©f√©r√© ?",
  reponses: ["one piece", "naruto", "hunterXhunter", "demon slayer"],
  bonne: "demon slayer",
  niveau: "Difficile",
  theme: "gabriel",
},
{
    question: "Quel est mon jeu vid√©o pr√©f√©r√© actuelle ?",
    reponses: ["fifa" , "minecraft", "NBA2k", "fortnite"],
    bonne: "NBA2k",
    niveau: "Difficile",
    theme: "gabriel",
},
{
    question: "J√©tais dans quel coll√®ge ?",
    reponses: ["Emile Zola", "Les Provinces", "Le Ferronay", "La Bucaille"], 
    bonne: "Emile Zola",
    niveau: "Difficile",
    theme: "gabriel",
},
{
    question: "Quelle sont les pote que je connais depuis le plus longtemps ?",
    reponses: ["Alexis et Antonin", "Titouan et eliott", "Nino et Titouan", "Eliott et Nino"],
    bonne: "Nino et Titouan",
    niveau: "Difficile",
    theme: "gabriel",
},
{
    question: "Quel a √©t√© mon premier voyage √† l'√©tranger ?",
    reponses: ["Espagne", "Croatie", "Maroc", "Gr√®ce"],
    bonne: "Maroc",
    niveau: "Difficile",
    theme: "gabriel",
}








];



let timerInterval;
let tempsRestant = 20; // secondes par question

// Fonction pour tirer X questions al√©atoires de chaque niveau
function tirerQuestionsSelonNiveau() {
    const themeQuiz = localStorage.getItem("themeQuiz") || "Culture G√©n√©rale";
    const niveauQuiz = localStorage.getItem("niveauQuiz") || "Mixte";

    // Filtrer d'abord par th√®me
    let questionsFiltrees = toutesLesQuestions;
    if (themeQuiz === "Basket") {
        questionsFiltrees = toutesLesQuestions.filter(q => q.theme === "Basket");
    } else if (themeQuiz === "Culture G√©n√©rale") {
        questionsFiltrees = toutesLesQuestions.filter(q => q.theme === "Culture G√©n√©rale");
    }

    // Ensuite filtrer par niveau
    const faciles = questionsFiltrees.filter(q => q.niveau === "Facile");
    const moyens = questionsFiltrees.filter(q => q.niveau === "Moyen");
    const difficiles = questionsFiltrees.filter(q => q.niveau === "Difficile");

    let questionsSelectionnees = [];

    // S√©lection selon le niveau
    switch(niveauQuiz) {
        case "Facile":
            questionsSelectionnees = melanger(faciles).slice(0, 20);
            break;
        case "Moyen":
            questionsSelectionnees = melanger(moyens).slice(0, 20);
            break;
        case "Difficile":
            questionsSelectionnees = melanger(difficiles).slice(0, 20);
            break;
        default: // Mixte
            questionsSelectionnees = [
                ...melanger(faciles).slice(0, 10),
                ...melanger(moyens).slice(0, 10),
                ...melanger(difficiles).slice(0, 10)
            ];
    }

    // Si pas assez de questions, compl√©ter avec d'autres niveaux
    if (questionsSelectionnees.length < 10) {
        const questionsRestantes = questionsFiltrees
            .filter(q => !questionsSelectionnees.includes(q));
        const complement = melanger(questionsRestantes)
            .slice(0, 10 - questionsSelectionnees.length);
        questionsSelectionnees = [...questionsSelectionnees, ...complement];
    }

    return questionsSelectionnees;
}


const questions = tirerQuestionsSelonNiveau();




    // R√©cup√®re les joueurs depuis la page pr√©c√©dente
    const joueurs = JSON.parse(localStorage.getItem("joueurs") || "[]");
    joueurs.forEach(j => j.score = 0); // initialise les scores

    const joueursInfosDiv = document.getElementById("joueursInfos");
    joueurs.forEach(joueur => {
      const p = document.createElement("p");
      p.className = "joueur";
      joueursInfosDiv.appendChild(p);
    });

    let questionIndex = 0;
    let joueurIndex = 0;

  

 


  function afficherQuestion() {
    const quiz = document.getElementById("quiz");
    quiz.classList.remove("fade-in");
    quiz.classList.add("fade-out");

    setTimeout(() => {
        // V√©rifier si le quiz est termin√©
        if (questionIndex >= questions.length) {
            afficherScoresFinaux();
            return;
        }

    const joueur = joueurs[joueurIndex];
    const q = questions[questionIndex];

    document.getElementById("joueurActuel").innerHTML = 
      `C'est √† <strong style="color:${joueur.couleur}">${joueur.nom}</strong> de r√©pondre.`;

    document.getElementById("question-text").innerHTML = 
      `${q.question} <span style="font-size:0.8em;color:gray;">[${q.niveau}]</span>`;

    const reponsesDiv = document.getElementById("reponses");
    reponsesDiv.innerHTML = "";

    const reponsesMelangees = melanger([...(q.reponses || q.choix)]);
    reponsesMelangees.forEach(rep => {
        const btn = document.createElement("div");
        btn.className = "reponse";
        btn.textContent = rep;
        btn.onclick = () => verifier(rep);
        reponsesDiv.appendChild(btn);
    });
    
    document.getElementById("resultat").textContent = "";

    // D√©marre le timer
    tempsRestant = 20;
    document.getElementById("timer").textContent = `Temps restant : ${tempsRestant} sec`;
    document.getElementById("progress-bar").style.width = "100%";

    clearInterval(timerInterval); // stoppe le timer pr√©c√©dent

    quiz.classList.remove("fade-out");
    quiz.classList.add("fade-in");

    timerInterval = setInterval(() => {
      tempsRestant--;
      document.getElementById("timer").textContent = `Temps restant : ${tempsRestant} sec`;

      // Met √† jour la barre de progression
      const pourcentage = (tempsRestant / 20) * 100;
      const progressBar = document.getElementById("progress-bar");
      progressBar.style.width = `${pourcentage}%`;

      if (tempsRestant <= 5) {
        progressBar.style.backgroundColor = "red";
      } else if (tempsRestant <= 10) {
        progressBar.style.backgroundColor = "orange";
      } else {
        progressBar.style.backgroundColor = "green";
      }

      if (tempsRestant <= 0) {
        clearInterval(timerInterval);
        verifier(null); // Temps √©coul√© = pas de r√©ponse
      }
    }, 1000);

  }, 300);
}

function verifier(reponse) {
  clearInterval(timerInterval); // Arr√™te le timer

  // D√©sactive tous les boutons r√©ponses pour emp√™cher plusieurs clics
  document.querySelectorAll(".reponse").forEach(btn => {
    btn.onclick = null;
  });

  const questionActuelle = questions[questionIndex];
  const bonne = questionActuelle.bonne || questionActuelle.bonneReponse;
  const joueur = joueurs[joueurIndex];
  const resultat = document.getElementById("resultat");

  const normalize = v => String(v).toLowerCase().trim();

  // cas timeout
  if (reponse === null) {
    const bonnesAff = Array.isArray(bonne) ? bonne.join(", ") : bonne;
    resultat.textContent = `‚è±Ô∏è Temps √©coul√© ! La bonne r√©ponse √©tait : ${bonnesAff}`;
    resultat.style.color = "orange";
  } else {
    // si "bonne" est un tableau => accepter n'importe quel alias dedans
    if (Array.isArray(bonne)) {
      const bonneSet = new Set(bonne.map(normalize));
      const userAns = normalize(reponse);

      if (bonneSet.has(userAns)) {
        joueur.score++;
        resultat.innerHTML = `Bonne r√©ponse ! ‚úÖ`;
        resultat.style.color = "green";
        document.querySelectorAll('.reponse').forEach(btn => {
          if (normalize(btn.textContent) === userAns) btn.classList.add('correct');
        });
      } else {
        resultat.textContent = `Mauvaise r√©ponse ‚ùå La bonne(s) r√©ponse(s) : ${bonne.join(", ")}`;
        resultat.style.color = "red";
        document.querySelectorAll('.reponse').forEach(btn => {
          if (bonneSet.has(normalize(btn.textContent))) btn.classList.add('correct');
          if (normalize(btn.textContent) === userAns) btn.classList.add('wrong');
        });
      }
    } else {
      // comportement single-answer existant
      const userAns = normalize(reponse);
      const bonneStr = normalize(bonne);
      document.querySelectorAll('.reponse').forEach(btn => {
        const val = normalize(btn.textContent);
        if (val === bonneStr) btn.classList.add('correct');
        if (val === userAns && val !== bonneStr) btn.classList.add('wrong');
      });
      if (userAns === bonneStr) {
        joueur.score++;
        resultat.innerHTML = `Bonne r√©ponse ! ‚úÖ`;
        resultat.style.color = "green";
      } else {
        resultat.textContent = `Mauvaise r√©ponse ‚ùå La bonne r√©ponse √©tait : ${bonne}`;
        resultat.style.color = "red";
      }
    }
  }

  questionIndex++;
  joueurIndex = (joueurIndex + 1) % joueurs.length;

  // d√©lai avant la question suivante (augment√© pour laisser plus de temps pour voir le r√©sultat)
  setTimeout(() => {
    if (questionIndex >= questions.length) {
      afficherScoresFinaux();
    } else {
      afficherQuestion();
    }
  }, 3500); // <-- anciennement 2000
}

function afficherScoresFinaux() {
    clearInterval(timerInterval);
    const quiz = document.getElementById("quiz");
    quiz.className = ""; // Reset des classes

    const joueursTri√©s = [...joueurs].sort((a, b) => b.score - a.score);
    
    quiz.innerHTML = `
        <div class="score-final">
            <h2>üéÆ Quiz termin√© ! üéÆ</h2>
            <h3>üèÜ Classement final (sur 20) üèÜ</h3>
            <div class="scores-list">
                ${joueursTri√©s.map((joueur, index) => `
                    <div class="score-item ${index === 0 ? 'winner' : ''}">
                        <span class="medal">${index === 0 ? 'ü•á' : index === 1 ? 'ü•à' : index === 2 ? 'ü•â' : (index + 1)}</span>
                        <span class="player-name" style="color: ${joueur.couleur}">${joueur.nom}</span>
                        <span class="score">${joueur.score} point${joueur.score > 1 ? 's' : ''}</span>
                    </div>
                `).join('')}
            </div>
            <div class="buttons-container">
                <button class="btn-final" onclick="window.location.reload()">üîÑ Rejouer</button>
                <button class="btn-final" onclick="window.location.href='index.html'">üè† Accueil</button>
            </div>
            <br> 
          <div class="pub-container">
          <p>üî• D√©couvrez aussi le vrai site STI-ZHEIMER :</p>
           <a href="https://enternos50.github.io/STI-ZHEIMER/" target="_blank" class="pub-lien">
           <img src="cerveau img.jpeg" alt="Site partenaire" class="pub-logo">
           <span></span>
           </a>
          </div>

        </div>
    `;
}

function rejouer() {
    questionIndex = 0;
    joueurIndex = 0;
    joueurs.forEach(j => j.score = 0);
    afficherQuestion();
}

function allerAccueil() {
    window.location.href = 'index.html';
}

document.addEventListener('DOMContentLoaded', function() {
    const bgMusic = document.getElementById('bgMusic');
    bgMusic.volume = 0.5; // Volume √† 50%
    
    const musicBtn = document.createElement('button');
    musicBtn.innerHTML = 'üéµ Musique';
    musicBtn.className = 'btn-music';
    
    let isMusicPlaying = false;
    
   
    document.body.insertBefore(musicBtn, document.body.firstChild);
});





    
    afficherQuestion();

  </script>
  </body>
  </html>